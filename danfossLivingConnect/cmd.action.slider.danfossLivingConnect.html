<div class="cmd cmd-widget" data-type="action" data-subtype="slider" data-template="button" data-cmd_id="#id#"
  data-cmd_uid="#uid#" data-version="#version#" data-eqLogic_id="#eqLogic_id#"
  style="min-width: 80px;display: inline-flex;flex-direction: column; align-items: center;">
  <!--
	  Name: cmd.action.slider.danfossLivingConnect.html
    Jeedom Compatibility: v4.4.5
    Version 2.0.0 - 2024-04-29
  -->

  <div class="danfossImg #version#_danfossImg"></div>
  <div class="state_danfoss state_#version#_danfoss state_color_font_default consigne value"></div>
  <div class="statedec_danfoss statedec_#version#_danfoss state_color_font_default consigne value"></div>
  <div class="unite_danfoss unite_#version#_danfoss state_color_font_default value">#unite#</div>
  <div class="btn_ctrl_danfoss minus_danfoss minus_#version#_danfoss"></div>
  <div class="btn_ctrl_danfoss plus_danfoss plus_#version#_danfoss"></div>
  <div class="btn_switch_danfoss switch_#version#_danfoss"></div>
  <input type="hidden" class="switch#id#"></input>

  <style>
    @font-face {
      font-family: "Digital-7";
      src: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/digital-7-italic.ttf') format("truetype");
    }

    [data-cmd_id="#id#"] cmd cmd-widget {
      position: relative;
      height: 81px;
    }

    [data-cmd_id="#id#"] .dashboard_danfossImg {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss.png') no-repeat;
    }

    [data-cmd_id="#id#"] .mobile_danfossImg {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss_buttons.png') no-repeat;
    }

    [data-cmd_id="#id#"] .danfossLC_buttons {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss_buttons.png') no-repeat;
    }

    [data-cmd_id="#id#"] .danfossLC_plus {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss_plus.png') no-repeat;
    }

    [data-cmd_id="#id#"] .danfossLC_minus {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss_minus.png') no-repeat;
    }

    [data-cmd_id="#id#"] .danfossLC_down {
      width: 80px;
      height: 80px;
      background: url('data/customTemplates/dashboard/cmd.action.slider.danfossLivingConnect/danfoss_down.png') no-repeat;
    }

    [data-cmd_id="#id#"] .state_danfoss {
      font-family: "Digital-7";
      font-size: 23px;
      font-weight: normal !important;
      position: absolute;
      letter-spacing: 1px;
    }

    [data-cmd_id="#id#"] .state_dashboard_danfoss {
      top: 60px;
      padding-right: 5px;
    }

    [data-cmd_id="#id#"] .state_mobile_danfoss {
      top: 58px;
      padding-right: 5px;
    }

    [data-cmd_id="#id#"] .statedec_danfoss {
      font-family: "Digital-7";
      font-size: 12px;
      font-weight: normal !important;
      position: absolute;
    }

    [data-cmd_id="#id#"] .statedec_dashboard_danfoss {
      top: 63px;
      padding-left: 20px;
    }

    [data-cmd_id="#id#"] .statedec_mobile_danfoss {
      top: 68px;
      padding-left: 24px;
    }

    [data-cmd_id="#id#"] .unite_danfoss {
      font-family: "Digital-7";
      font-size: 8px;
      font-weight: normal !important;
      position: absolute;
    }

    [data-cmd_id="#id#"] .unite_dashboard_danfoss {
      top: 54px;
      padding-left: 23px;
    }

    [data-cmd_id="#id#"] .unite_mobile_danfoss {
      top: 63px;
      padding-left: 24px;
    }

    [data-cmd_id="#id#"] .btn_ctrl_danfoss {
      position: absolute;
      cursor: pointer;
      width: 14px;
      height: 21px;
    }

    [data-cmd_id="#id#"] .minus_dashboard_danfoss {
      top: 54px;
      margin-right: 64px;
    }

    [data-cmd_id="#id#"] .minus_mobile_danfoss {
      top: 60px;
      margin-right: 64px;
    }

    [data-cmd_id="#id#"] .plus_dashboard_danfoss {
      top: 54px;
      margin-left: 64px;
    }

    [data-cmd_id="#id#"] .plus_mobile_danfoss {
      top: 60px;
      margin-left: 64px;
    }

    [data-cmd_id="#id#"] .btn_switch_danfoss {
      position: absolute;
      cursor: pointer;
      width: 21px;
      height: 17px;
    }

    [data-cmd_id="#id#"] .switch_dashboard_danfoss {
      top: 87px;
    }

    [data-cmd_id="#id#"] .switch_mobile_danfoss {
      top: 94px;
    }
  </style>
  <script>
    var consigne_pending_cdeName = 'Consigne pending';
    var consigne_cdeName = 'Consigne';
    var battery_cdeName = 'Batterie';
    var switch_mode_consigne = 'consigne';
    var switch_mode_battery = 'battery';
    hideWidget('#uid#', consigne_cdeName);
    hideWidget('#uid#', consigne_pending_cdeName);
    hideWidget('#uid#', battery_cdeName);

    jeedom.cmd.addUpdateFunction('#id#', function (_options) {
      if (is_object(cmd = document.querySelector('.cmd[data-cmd_uid="#uid#"]'))) {
        if ('#time#' === 'duration' || '#time#' === 'date') {
          jeedom.cmd.displayDuration(_options.valueDate, cmd.querySelector('.timeCmd'), '#time#');
        }

        setDanfossValue('#uid#', getDanfossValueDisplay('#uid#'), switch_mode_consigne)
      }
    })

    jeedom.cmd.refreshValue([{ cmd_id: '#id#', value: '#state#', display_value: '#state#', valueDate: '#valueDate#', collectDate: '#collectDate#', alertLevel: '#alertLevel#', unit: '#unite#' }])

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .plus_danfoss').addEventListener('mouseover', () => {
      showImg('#uid#', 'danfossLC_plus');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .plus_danfoss').addEventListener('mouseout', () => {
      showImg('#uid#', 'dashboard_danfossImg');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .plus_danfoss').addEventListener('click', () => {
      let max = ('#maxValue#' == '') ? 28 : parseFloat('#maxValue#');
      let step = (isNaN(parseFloat('#step#'))) ? 0.5 : parseFloat('#step#');


      var danfossValue = getDanfossValueDisplay('#uid#');

      if (parseFloat(danfossValue) <= max - step) {

        let value = (parseFloat(danfossValue) + step).toFixed(1);

        setDanfossValue('#uid#', value, switch_mode_consigne);
        setConsignePending('#id#', '#uid#', value);
      }
    });



    document.querySelector('.cmd[data-cmd_uid="#uid#"] .minus_danfoss').addEventListener('mouseover', () => {
      showImg('#uid#', 'danfossLC_minus');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .minus_danfoss').addEventListener('mouseout', () => {
      showImg('#uid#', 'dashboard_danfossImg');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .minus_danfoss').addEventListener('click', () => {
      let min = ('#minValue#' == '') ? 4 : parseFloat('#minValue#');
      let step = (isNaN(parseFloat('#step#'))) ? 0.5 : parseFloat('#step#');

      var danfossValue = getDanfossValueDisplay('#uid#');

      if (parseFloat(danfossValue) >= min + step) {

        let value = (parseFloat(danfossValue) - step).toFixed(1);

        setDanfossValue('#uid#', value, switch_mode_consigne);
        setConsignePending('#id#', '#uid#', value);
      }
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .btn_switch_danfoss').addEventListener('mouseover', () => {
      showImg('#uid#', 'danfossLC_down');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .btn_switch_danfoss').addEventListener('mouseout', () => {
      showImg('#uid#', 'dashboard_danfossImg');
    });

    document.querySelector('.cmd[data-cmd_uid="#uid#"] .btn_switch_danfoss').addEventListener('click', () => {
      let switchMode = document.querySelector('.cmd[data-cmd_uid="#uid#"] .switch#id#');
      let value = -4;

      if (switchMode.innerText === "" || switchMode.innerText === switch_mode_consigne) {
        switchMode.innerText = switch_mode_battery;

        value = getDanfossBatteryValue('#uid#');
      }
      else if (switchMode.innerText === switch_mode_battery) {
        switchMode.innerText = switch_mode_consigne;

        value = getDanfossValueDisplay('#uid#');
      }

      setDanfossValue('#uid#', value, switchMode.innerText);
    });

    function showImg(cmdWidgetId, classImg) {
      if ('#version#' !== 'mobile') {
        document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]  .danfossImg').classList.remove('danfossLC_buttons').classList.remove('danfossLC_plus').remove('danfossLC_minus').remove('danfossLC_down').addClass(classImg);
      }
    }

    function hideWidget(cmdWidgetId, cmdName) {
      var widgetHasHidden = getWidgetInfoNumericDefault(cmdWidgetId, cmdName);
      if (widgetHasHidden !== null) {
        widgetHasHidden.style.display = 'none';
      }
    }

    function getWidgetInfoNumericDefault(cmdWidgetId, cmdName) {
      let cmdFind = false;
      var spans = document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]').parentElement.getElementsByTagName('span');

      for (let element of spans) {
        if (element.getAttribute('class').includes('cmdName') && element.innerHTML === cmdName) {
          cmdFind = true;
        }

        if (cmdFind && element.getAttribute('class').includes('value')) {
          return element.parentElement.parentElement;
        }

        if (cmdFind) {
          // mobile
          var elts = element.parentElement.getElementsByTagName('strong');
          for (let elt of elts) {
            if (elt.getAttribute('class').includes('state')) {
              return elt.parentElement.parentElement;
            }
          }
        }
      }

      return null;
    }

    function getWidgetInfoNumericDefaultValue(cmdWidgetId, cmdName) {
      let cmdFind = false;
      var spans = document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]').parentElement.getElementsByTagName('span');

      for (let element of spans) {
        if (element.getAttribute("class").includes('cmdName') && element.innerHTML === cmdName) {
          cmdFind = true;
        }

        if (cmdFind && element.getAttribute('class').includes('value')) {
          return element.innerText;
        }

        if (cmdFind) {
          // mobile
          var elts = element.parentElement.getElementsByTagName('strong');
          for (let elt of elts) {
            if (elt.getAttribute('class').includes('state')) {
              return elt.innerText;
            }
          }
        }
      }

      return '';
    }

    function setDanfossValue(cmdWidgetId, danfossVal, mode) {
      var valeur = parseFloat(danfossVal);
      var intNum = Math.floor(valeur);
      var decNum = Math.round((valeur - intNum) * 10);
      var cmd = document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]');
      cmd.getElementsByClassName('state_danfoss')[0].innerText = intNum;

      if (decNum !== 0) {
        cmd.getElementsByClassName('statedec_danfoss')[0].innerText = decNum;
      }
      else {
        cmd.getElementsByClassName('statedec_danfoss')[0].innerText = '';
      }

      if (mode === '' || mode === switch_mode_consigne) {
        cmd.getElementsByClassName('unite_danfoss')[0].innerText = '#unite#';
      }
      else if (mode === switch_mode_battery) {
        cmd.getElementsByClassName('unite_danfoss')[0].innerText = '%';
      }
    }

    function setConsignePending(identifier, cmdWidgetId, value) {
      let valueInterface = getWidgetInfoNumericDefault(cmdWidgetId, consigne_pending_cdeName).getElementsByClassName('value');
      let valueFind = false;

      if (valueInterface.length > 0) {
        valueInterface[0].innerText = value;
        valueFind = true;
      }

      if (!valueFind) {
        // mobile
        valueInterface = getWidgetInfoNumericDefault(cmdWidgetId, consigne_pending_cdeName).getElementsByClassName('state');

        if (valueInterface.length > 0) {
          valueInterface[0].innerText = value;
          valueFind = true;
        }
      }

      if (valueFind) {
        clearTimeout(window['timerHandle' + identifier])
        window['timerHandle' + identifier] = setTimeout(function () {
          jeedom.cmd.execute({ id: identifier, value: { slider: value } })
        }, 1000);
      }
    }

    function getDanfossValueDisplay(cmdWidgetId) {
      let consigne = getDanfossConsigneValue(cmdWidgetId, consigne_cdeName, -1);
      let consignePending = getDanfossConsigneValue(cmdWidgetId, consigne_pending_cdeName, -2);

      let showValue = consigne;
      var cmd = document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]');
      if (consigne !== consignePending) {

        showValue = consignePending;
        cmd.getElementsByClassName('state_danfoss')[0].style.color = '#bb3434';
        cmd.getElementsByClassName('statedec_danfoss')[0].style.color = '#bb3434';
        cmd.getElementsByClassName('unite_danfoss')[0].style.color = '#bb3434';
      }
      else {
        cmd.getElementsByClassName('state_danfoss')[0].style.color = '#323232';
        cmd.getElementsByClassName('statedec_danfoss')[0].style.color = '#323232';
        cmd.getElementsByClassName('unite_danfoss')[0].style.color = '#323232';
      }

      return showValue;
    }

    function getDanfossBatteryValue(cmdWidgetId) {
      let percent = getWidgetInfoNumericDefaultValue(cmdWidgetId, battery_cdeName);
      if (isNaN(parseFloat(percent))) {
        consigne = -3;
      }

      var cmd = document.querySelector('.cmd[data-cmd_uid="' + cmdWidgetId + '"]');
      cmd.getElementsByClassName('state_danfoss')[0].style.color = '#323232';
      cmd.getElementsByClassName('statedec_danfoss')[0].style.color = '#323232';
      cmd.getElementsByClassName('unite_danfoss')[0].style.color = '#323232';

      return parseFloat(percent);
    }

    function getDanfossConsigneValue(cmdWidgetId, cdeName, errorCode) {
      let consigne = getWidgetInfoNumericDefaultValue(cmdWidgetId, cdeName);
      if (isNaN(parseFloat(consigne))) {
        return errorCode;
      }

      return parseFloat(consigne);
    }

    function setDanfossConsignePendingValue(cmdWidgetId, pendingValue) {
      setWidgetInfoNumericDefaultValue(cmdWidgetId, consigne_pending_cdeName, pendingValue.toFixed(1))
    }

    function setWidgetInfoNumericDefaultValue(cmdWidgetId, cmdName, value) {
      let widget = getWidgetInfoNumericDefault(cmdWidgetId, cmdName).getElementsByClassName('value')[0].innerText = value.toFixed(1);
    }

    function showImg(uid, classImg) {
      if ('#version#' !== 'mobile') {
        $('.cmd[data-cmd_uid=' + uid + '] .danfossImg').removeClass('danfossLC_buttons').removeClass('danfossLC_plus').removeClass('danfossLC_minus').removeClass('danfossLC_down').addClass(classImg);
      }
    }
  </script>
</div>